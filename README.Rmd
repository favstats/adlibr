---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  eval = FALSE
)
```

# liads

<!-- badges: start -->
[![R-CMD-check](https://github.com/favstats/liads/workflows/R-CMD-check/badge.svg)](https://github.com/favstats/liads/actions)
[![CRAN status](https://www.r-pkg.org/badges/version/liads)](https://CRAN.R-project.org/package=liads)
[![Lifecycle: stable](https://img.shields.io/badge/lifecycle-stable-brightgreen.svg)](https://lifecycle.r-lib.org/articles/stages.html#stable)
<!-- badges: end -->

**liads** is a comprehensive R client for the [LinkedIn Ad Library API](https://www.linkedin.com/ad-library/api/ads). It provides tools for OAuth 2.0 authentication, querying ads by various criteria, automatic pagination, and robust data processing.

## Features

- **ğŸ” OAuth 2.0 Authentication**: Complete 3-legged authentication workflow
- **ğŸ” Comprehensive Search**: Query by keyword, advertiser, country, and date range
- **ğŸ“Š Automatic Pagination**: Handles large result sets automatically
- **ğŸ›¡ï¸ Robust Error Handling**: Graceful handling of API errors and edge cases
- **ğŸ“ˆ Rich Data Structure**: Returns structured data with targeting and impression data
- **âœ… Full API Coverage**: Supports all parameters from the official LinkedIn API

## Installation

You can install the development version of liads from [GitHub](https://github.com/favstats/liads) with:

``` r
# install.packages("devtools")
devtools::install_github("favstats/liads")
```

## Quick Start

### 1. Authentication Setup

First, set up your LinkedIn Developer App credentials (one-time setup):

```{r setup}
library(liads)

# Configure your LinkedIn app credentials
li_auth_configure()  # You'll be prompted to enter Client ID and Secret

# Authenticate (opens browser for OAuth)
li_auth()
```

### 2. Basic Usage

```{r basic-usage}
# Search for ads by keyword
marketing_ads <- li_query(
  keyword = "digital marketing",
  countries = c("us", "ca"),
  start_date = "2024-01-01",
  end_date = "2024-03-31"
)

# Search for ads by advertiser
google_ads <- li_query(
  advertiser = "Google",
  countries = c("us"),
  max_pages = 5
)

# Search for recent ads in specific countries
recent_ads <- li_query(
  countries = c("gb", "de", "fr"),
  start_date = "2024-06-01",
  end_date = "2024-06-30"
)
```

## API Parameters

The `li_query()` function supports all parameters from the [LinkedIn Ad Library API](https://www.linkedin.com/ad-library/api/ads):

| Parameter | Type | Description | Example |
|-----------|------|-------------|---------|
| `keyword` | String | Keywords to search in ad content (AND logic) | `"data science"` |
| `advertiser` | String | Advertiser name to search | `"Microsoft"` |
| `countries` | Character vector | 2-letter ISO country codes | `c("us", "gb", "de")` |
| `start_date` | Date/String | Start date (inclusive) | `"2024-01-01"` |
| `end_date` | Date/String | End date (exclusive) | `"2024-12-31"` |
| `count` | Integer | Results per page (max 25) | `25` |
| `max_pages` | Integer | Maximum pages to retrieve | `10` |

## Data Structure

The function returns a tibble with the following columns:

```{r data-structure}
# View the structure of returned data
str(marketing_ads)

# Key columns include:
# - ad_url: Direct link to ad preview
# - advertiser_name: Name of the advertiser
# - ad_type: Type of advertisement
# - first_impression_at, latest_impression_at: Date ranges
# - total_impressions_from, total_impressions_to: Impression ranges
# - impressions_by_country: List-column with country breakdown
# - ad_targeting: List-column with targeting criteria
```

## Advanced Examples

### Search with Multiple Criteria

```{r advanced-search}
# Complex search combining multiple parameters
tech_ads <- li_query(
  keyword = "artificial intelligence machine learning",
  countries = c("us", "gb", "de", "fr"),
  start_date = "2024-01-01",
  end_date = "2024-06-30",
  max_pages = 10
)

print(paste("Found", nrow(tech_ads), "AI/ML ads"))
```

### Analyze Targeting Data

```{r targeting-analysis}
# Extract and analyze targeting information
targeting_data <- tech_ads |>
  tidyr::unnest(ad_targeting) |>
  dplyr::filter(!is.na(facetName))

# Most common targeting criteria
targeting_summary <- targeting_data |>
  dplyr::count(facetName, sort = TRUE)

print(targeting_summary)
```

### Country-wise Impression Analysis

```{r impression-analysis}
# Analyze impression distribution by country
impression_data <- tech_ads |>
  tidyr::unnest(impressions_by_country) |>
  dplyr::filter(!is.na(country))

# Top countries by impression percentage
country_summary <- impression_data |>
  dplyr::group_by(country) |>
  dplyr::summarise(
    avg_impression_pct = mean(impressions, na.rm = TRUE),
    .groups = "drop"
  ) |>
  dplyr::arrange(desc(avg_impression_pct))

print(country_summary)
```

## Error Handling

The package includes robust error handling:

```{r error-handling}
# Handles authentication errors
tryCatch({
  ads <- li_query(keyword = "test")
}, error = function(e) {
  message("Authentication required: ", e$message)
})

# Handles API errors gracefully
ads_with_errors <- li_query(
  keyword = "nonexistent search term",
  countries = c("xx"),  # Invalid country code
  verbose = TRUE
)
# Returns empty data frame instead of crashing
```

## Rate Limits and Best Practices

- **Maximum 25 results per request** (API limitation)
- **Use pagination** for large datasets with `max_pages` parameter
- **Specific searches** may return fewer results than broad searches
- **Date ranges**: start is inclusive, end is exclusive
- **Keywords**: Multiple keywords use AND logic
- **Countries**: Use lowercase 2-letter ISO codes

## Authentication Details

The package uses OAuth 2.0 with automatic token caching:

1. **Setup**: `li_auth_configure()` stores app credentials in `.Renviron`
2. **Authentication**: `li_auth()` opens browser for user consent
3. **Token Storage**: Tokens are cached in `.httr-oauth` for reuse
4. **Automatic Refresh**: Tokens are automatically refreshed when needed

## API Reference

Full API documentation is available at: https://www.linkedin.com/ad-library/api/ads

## Contributing

Please report bugs and feature requests at: https://github.com/favstats/liads/issues

## License

MIT License. See `LICENSE` file for details.